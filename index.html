<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Machine Noise</title>
<style>
input[type=range] {
    -webkit-appearance: none;
    display: block;
    margin: 1em auto;
    width: 50%;
}
input[type=range]::-webkit-slider-runnable-track {
    width: 50%;
    height: 16px;
    background: #ddd;
    border: none;
    border-radius: 8px;
}
input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    border: none;
    height: 32px;
    width: 32px;
    border-radius: 50%;
    background: goldenrod;
    margin-top: -8px;
}
input[type=button] {
    display: block;
    margin: 3em auto;
    width: 50%;
    padding: 30px;
    font-size: 200%;
}
</style>
</head>

<body style="text-align:center; background:white; position:relative;">

<div id='controls' style='position:absolute; top:50%; width:100%;'>
<input type="button" value="White noise" onclick="toggle_play('white');"/>
<input type="button" value="Test music" onclick="toggle_play('notes');"/>
<input id="volume-slider" type="range" min="0.0" max="1.0" step="0.01"/>
</div>

<script>
var context = new AudioContext();
var sample_duration_seconds = 1.0;
var bufferSize = 2 << 12; // sample_duration_seconds * context.sampleRate; // buffer is a time series of notes
var sounds = {};
function init_sound(name) {
    var input_channels = 0;
    var output_channels = 1;
    sounds[name] = context.createScriptProcessor(bufferSize, input_channels, output_channels);
    sounds[name].playing = false;
}
var volume_slider = document.getElementById('volume-slider');
volume_slider.value = 0.5;

init_sound('white');
sounds['white'].onaudioprocess = function(e) {
  var outputBuffer = e.outputBuffer;
  for (var channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
    var outputData = outputBuffer.getChannelData(channel);
    for (var i = 0; i < bufferSize; i++) {
      outputData[i] = volume_slider.value * ( Math.random()*2-1 ); // audio points are in range [-1.0,1.0]
    }
  }
}
init_sound('test');
sounds['test'].onaudioprocess = function(e) {
  var outputBuffer = e.outputBuffer;
  var start_time = +new Date();
  for (var channel = 0; channel < outputBuffer.numberOfChannels; channel++) {
    var outputData = outputBuffer.getChannelData(channel);
    for (var i = 0; i < bufferSize; i++) {
      var time = i/context.sampleRate + start_time/1000;
      var frequency = 400;
      var angle = 2 * 3.14159 * frequency * time;
      outputData[i] = volume_slider.value;
    }
  }
}

var name = 'notes';
sounds[name] = context.createOscillator();
sounds[name].frequency.value = 261.6; // middle C
sounds[name].playing = false;
sounds[name].start(0);

function strobe_note() {
  var milliseconds = +new Date();
  sounds['notes'].frequency.value = 200+(milliseconds/10) % 200
}
function rand_note() {
  sounds['notes'].frequency.value = 200+Math.random()*200;
}
function rand_walk() {
  sounds['notes'].frequency.value += (Math.random()-0.5)*20 + (Math.random()-0.5)*20 + (Math.random()-0.5)*20; //approximate Gaussian
  if( sounds['notes'].frequency.value > 500 ) 500*2 - sounds['notes'].frequency.value;
  if( sounds['notes'].frequency.value < 200 ) 200*2 - sounds['notes'].frequency.value;
}
var semitone_distances = [0,2,4,5,7,9,11,12];
function equal_temperament() {
  semitone_distance = semitone_distances[ (Math.random()*semitone_distances.length()) | 0 ];
  sounds['notes'].frequency.value = 440 * Math.pow(2, (semitone_distance/12));
}
setInterval(equal_temperament, 500);

function toggle_play(sound_name) {
  var sound = sounds[sound_name];
  if(!sound.playing) {
    sound.connect(context.destination);
  } else {
    sound.disconnect(context.destination);
  }
  sound.playing = !sound.playing;
}

</script>
</body>
</html>

